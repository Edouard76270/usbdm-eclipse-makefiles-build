/*
 * console.c
 *
 *  Created on: 14/04/2013
 *      Author: pgo
 */

#include <derivative.h>
#include "system.h"
#include "hardware.h"
#if defined(USBDM_UART0_IS_DEFINED) || defined(USBDM_UART1_IS_DEFINED) || defined(USBDM_UART2_IS_DEFINED) || defined(USBDM_UART3_IS_DEFINED) || defined(USBDM_UART4_IS_DEFINED)
#include "uart.h"
#endif
#if defined(USBDM_LPUART0_IS_DEFINED) || defined(USBDM_LPUART1_IS_DEFINED) || defined(USBDM_LPUART2_IS_DEFINED)
#include "lpuart.h"
#endif
#include "console.h"

 /*
  * *****************************
  * *** DO NOT EDIT THIS FILE ***
  * *****************************
  *
  * This file is generated automatically.
  * Any manual changes will be lost.
  */

// Maps console to UART used
using  Console = $(/Console/console_device:USBDM::Uart0);

// Console instance
static Console *console = nullptr;

/*
 * Initialises the Console
 *
 * @param baudrate - the baud rate to use e.g. DEFAULT_BAUD_RATE
 */
extern "C"
void console_initialise(int baudRate) {
   if (console == nullptr) {
      console = new Console(baudRate);
   }
}

/*
 * Transmits a single character to Console
 *
 * @param ch - character to send
 */
extern "C"
void console_txChar(int ch) {
   console->tx(ch);
}

/*
 * Receives a single character fropm Console (blocking)
 *
 * @return - character received
 */
extern "C"
int console_rxChar(void) {
   int ch = console->rx();
   if (ch == '\r') {
      ch = '\n';
   }
   return ch;
}
